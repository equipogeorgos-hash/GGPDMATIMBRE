
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA DE TIMBRE ESCOLAR</title>
    <!-- Tailwind CSS para dise√±o profesional -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React y Babel para ejecutar l√≥gica moderna directamente en el navegador -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tipograf√≠a Outfit -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; }
        @keyframes ring {
            0%, 100% { transform: rotate(0); }
            20% { transform: rotate(15deg); }
            40% { transform: rotate(-15deg); }
            60% { transform: rotate(10deg); }
            80% { transform: rotate(-10deg); }
        }
        .bell-ringing { animation: ring 0.4s ease-in-out infinite; display: inline-block; }
        .clock-glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-slate-100 min-h-screen text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // --- CONFIGURACI√ìN DE HORARIOS ---
        const DAILY_SCHEDULE = [
            { time: "08:25", event: "AVISO", duration: 10 },
            { time: "08:30", event: "ENTRADA", duration: 15 },
            { time: "09:20", event: "AVISO", duration: 10 },
            { time: "09:25", event: "ENTRADA", duration: 15 },
            { time: "10:15", event: "AVISO", duration: 10 },
            { time: "10:20", event: "ENTRADA", duration: 15 },
            { time: "11:10", event: "SALIDA RECREO", duration: 15 },
            { time: "11:35", event: "AVISO FIN RECREO", duration: 10 },
            { time: "11:40", event: "ENTRADA", duration: 15 },
            { time: "12:30", event: "AVISO", duration: 10 },
            { time: "12:35", event: "ENTRADA", duration: 15 },
            { time: "13:25", event: "AVISO", duration: 10 },
            { time: "13:30", event: "ENTRADA", duration: 15 },
            { time: "14:20", event: "AVISO", duration: 10 },
            { time: "14:25", event: "ENTRADA", duration: 15 },
            { time: "15:15", event: "FIN JORNADA (M)", duration: 15 },
            { time: "15:55", event: "AVISO", duration: 10 },
            { time: "16:00", event: "ENTRADA", duration: 15 },
            { time: "16:50", event: "AVISO", duration: 10 },
            { time: "16:55", event: "ENTRADA", duration: 15 },
            { time: "17:45", event: "AVISO", duration: 10 },
            { time: "17:50", event: "ENTRADA", duration: 15 },
            { time: "18:40", event: "SALIDA RECREO (T)", duration: 15 },
            { time: "18:55", event: "AVISO FIN RECREO (T)", duration: 10 },
            { time: "19:00", event: "ENTRADA (T)", duration: 15 },
            { time: "19:50", event: "AVISO", duration: 10 },
            { time: "19:55", event: "ENTRADA", duration: 15 },
            { time: "20:45", event: "AVISO", duration: 10 },
            { time: "20:50", event: "ENTRADA", duration: 15 },
            { time: "21:40", event: "FIN JORNADA (T)", duration: 15 },
        ];

        // --- L√ìGICA DE FESTIVOS ---
        const checkHoliday = (date) => {
            const day = date.getDay();
            if (day === 0 || day === 6) return "Fin de semana";
            
            const iso = date.toISOString().split('T')[0];
            const holidays = {
                "2025-12-25": "Navidad",
                "2026-01-01": "A√±o Nuevo",
                "2026-05-01": "D√≠a del Trabajo"
                // A√±adir aqu√≠ m√°s fechas espec√≠ficas YYYY-MM-DD
            };
            return holidays[iso] || null;
        };

        // --- COMPONENTE PRINCIPAL ---
        function App() {
            const [now, setNow] = useState(new Date());
            const [soundOn, setSoundOn] = useState(false);
            const [ringing, setRinging] = useState(false);
            const [lastRung, setLastRung] = useState("");
            const audioCtx = useRef(null);

            const holiday = useMemo(() => checkHoliday(now), [now.toDateString()]);

            const timeToSecs = (t) => {
                const [h, m] = t.split(':').map(Number);
                return h * 3600 + m * 60;
            };

            const currentSecs = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();

            const next = useMemo(() => {
                return DAILY_SCHEDULE.find(item => timeToSecs(item.time) > currentSecs) || null;
            }, [currentSecs]);

            const secsLeft = next ? timeToSecs(next.time) - currentSecs : 0;

            const playBell = useCallback((dur) => {
                if (!audioCtx.current || !soundOn) return;
                setRinging(true);
                const ctx = audioCtx.current;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.type = 'sine';
                osc.frequency.setValueAtTime(880, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + dur);
                
                gain.gain.setValueAtTime(0.5, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + dur);
                
                osc.connect(gain);
                gain.connect(ctx.destination);
                
                osc.start();
                osc.stop(ctx.currentTime + dur);
                
                if (navigator.vibrate) navigator.vibrate([500, 200, 500]);
                setTimeout(() => setRinging(false), dur * 1000);
            }, [soundOn]);

            const initAudio = () => {
                if (!audioCtx.current) {
                    audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioCtx.current.state === 'suspended') audioCtx.current.resume();
                setSoundOn(true);
                playBell(0.2); // Test
            };

            useEffect(() => {
                const timer = setInterval(() => {
                    const d = new Date();
                    setNow(d);
                    
                    const timeStr = d.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit', hour12: false });
                    if (d.getSeconds() === 0 && !holiday) {
                        const event = DAILY_SCHEDULE.find(s => s.time === timeStr);
                        if (event && lastRung !== timeStr) {
                            playBell(event.duration);
                            setLastRung(timeStr);
                        }
                    }
                }, 1000);
                return () => clearInterval(timer);
            }, [holiday, lastRung, playBell]);

            const formatCountdown = (s) => {
                const m = Math.floor(s / 60);
                const sc = s % 60;
                return `${m}m ${sc < 10 ? '0' + sc : sc}s`;
            };

            return (
                <div className="flex flex-col min-h-screen">
                    <header className="bg-indigo-700 text-white p-6 shadow-xl flex justify-between items-center sticky top-0 z-50">
                        <div>
                            <h1 className="text-3xl font-black flex items-center gap-2">
                                <span className={ringing ? 'bell-ringing' : ''}>üîî</span>
                                TIMBRE OFICIAL
                            </h1>
                            <p className="text-indigo-200 text-[10px] font-bold tracking-[0.3em] uppercase">Sincronizaci√≥n Web en Tiempo Real</p>
                        </div>
                        <button 
                            onClick={initAudio}
                            className={`px-6 py-3 rounded-2xl font-black transition-all shadow-lg active:scale-95 ${soundOn ? 'bg-emerald-500' : 'bg-rose-500 animate-pulse'}`}
                        >
                            {soundOn ? 'üîä AUDIO ON' : 'üîá ACTIVAR SONIDO'}
                        </button>
                    </header>

                    <main className="max-w-2xl mx-auto w-full p-4 space-y-6">
                        {/* RELOJ PRINCIPAL */}
                        <div className="bg-white rounded-[2.5rem] p-10 shadow-2xl text-center border-b-8 border-slate-200 mt-4">
                            <p className="text-slate-400 font-black text-xs uppercase tracking-widest mb-2">Hora Local</p>
                            <h2 className="text-7xl md:text-8xl font-black text-slate-800 tabular-nums leading-none">
                                {now.toLocaleTimeString('es-ES', { hour12: false })}
                            </h2>
                            <p className="text-indigo-600 font-bold mt-4 capitalize text-xl">
                                {now.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}
                            </p>
                        </div>

                        {/* ESTADO PR√ìXIMO */}
                        {holiday ? (
                            <div className="bg-amber-500 text-white p-8 rounded-[2rem] shadow-lg flex items-center gap-6">
                                <span className="text-5xl">üóìÔ∏è</span>
                                <div><p className="font-black text-2xl uppercase">D√≠a no lectivo</p><p className="font-bold opacity-90">{holiday}</p></div>
                            </div>
                        ) : (
                            next && (
                                <div className="bg-slate-900 text-white p-8 rounded-[2.5rem] shadow-2xl relative overflow-hidden ring-4 ring-indigo-500/20">
                                    <div className="relative z-10 flex flex-col md:flex-row justify-between items-center gap-4 text-center md:text-left">
                                        <div>
                                            <p className="text-indigo-400 font-black text-[10px] uppercase tracking-widest mb-2">Siguiente se√±al</p>
                                            <h3 className="text-4xl font-black">{next.event}</h3>
                                            <p className="text-indigo-300 font-bold text-lg">Programado: {next.time}</p>
                                        </div>
                                        <div className="bg-white/10 px-6 py-4 rounded-3xl border border-white/10 backdrop-blur-sm">
                                            <p className="text-4xl font-black tabular-nums">{formatCountdown(secsLeft)}</p>
                                            <p className="text-indigo-400 text-[10px] font-black uppercase text-center">Faltan</p>
                                        </div>
                                    </div>
                                    <div className="absolute -right-8 -bottom-8 opacity-5">
                                        <span className="text-[140px]">‚è±Ô∏è</span>
                                    </div>
                                </div>
                            )
                        )}

                        {/* LISTADO DE HORARIO */}
                        <div className="bg-white rounded-[2.5rem] p-8 shadow-xl">
                            <h4 className="font-black text-slate-800 text-xl mb-6 flex items-center gap-2">
                                üìÖ Horario del Centro
                            </h4>
                            <div className="space-y-2">
                                {DAILY_SCHEDULE.map((item, i) => {
                                    const sTime = timeToSecs(item.time);
                                    const isPast = sTime < currentSecs;
                                    const isCurrent = next?.time === item.time;
                                    
                                    return (
                                        <div key={i} className={`flex items-center p-4 rounded-2xl border-2 transition-all ${
                                            isCurrent ? 'bg-indigo-50 border-indigo-500 shadow-md scale-[1.02]' : 
                                            isPast ? 'bg-slate-50 border-transparent opacity-30' : 
                                            'bg-white border-slate-100'
                                        }`}>
                                            <span className={`text-2xl font-black w-20 ${isCurrent ? 'text-indigo-600' : 'text-slate-400'}`}>
                                                {item.time}
                                            </span>
                                            <div className="flex-1 ml-4 border-l-2 border-slate-100 pl-4">
                                                <p className={`font-black ${isCurrent ? 'text-slate-900' : 'text-slate-600'}`}>{item.event}</p>
                                                <p className="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">Duraci√≥n: {item.duration}s</p>
                                            </div>
                                            {isCurrent && (
                                                <div className="bg-indigo-600 text-white text-[10px] font-black px-3 py-1 rounded-full animate-pulse">
                                                    PR√ìXIMO
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </main>

                    <footer className="p-10 text-center text-slate-400 text-[10px] font-black tracking-[0.5em] uppercase">
                        Sistema Sincronizado v4.0 ‚Ä¢ 2025
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
